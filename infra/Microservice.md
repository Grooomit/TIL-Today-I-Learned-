# MicroService Architecture

<!-- TOC -->

- [MicroService Architecture](#microservice-architecture)
  - [마이크로서비스란?](#%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4%EB%9E%80)
    - [마이크로서비스 아키텍처는 언제 필요한가?](#%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98%EB%8A%94-%EC%96%B8%EC%A0%9C-%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80)
  - [모놀리틱 아키텍처와 마이크로서비스 아키텍처](#%EB%AA%A8%EB%86%80%EB%A6%AC%ED%8B%B1-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98%EC%99%80-%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98)
    - [모놀리틱 아키텍처](#%EB%AA%A8%EB%86%80%EB%A6%AC%ED%8B%B1-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98)
    - [마이크로서비스 아키텍처](#%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98)
    - [API Gateway](#api-gateway)
      - [문제점](#%EB%AC%B8%EC%A0%9C%EC%A0%90)
      - [API Gateway를 이용한 해결책](#api-gateway%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EC%B1%85)

<!-- /TOC -->

<br>

## 마이크로서비스란?

> 하나의 큰 애플리케이션을 여러 개의 다른 역할을 수행하는 애플리케이션으로 분리하였을 때 각 애플리케이션을 의미하며, 이렇게 마이크로서비스를 분리하여 여러 개의 작은 애플리케이션으로 쪼개어 변경과 조합이 가능하도록 만든 아키텍처

- 각 서비스는 사용자 인증이나 주문 처리와 같은 특정 비즈니스 기능을 수행하도록 설계되며, HTTP 또는 REST 와 같은 프로토콜을 사용하여 다른 서비스와 통신한다.

- 하나의 단위로 배포되는 모놀리식 아키텍처와 달리 마이크로서비스를 사용하면 개발자가 개별 서비스를 독립적으로 개발, 테스트, 배포할 수 있으므로 유연성과 민첩성이 향상된다.

- 확장성, 장애 격리, 시스템 유지보수 향상

<br>

### 마이크로서비스 아키텍처는 언제 필요한가?

> 모든 애플리케이션이 마이크로서비스 아키텍처 패턴으로 구성될 필요는 없다. 특히 적은 인원으로 빠르게 시작해야 하는 스타트업의 경우

- 애플리케이션의 배포에 한 시간 이상 소요된다.
- 단순한 기능 하나를 수정해도 전체 기능에 대한 QA가 필요하다.
- 단순한 버그 수정이 더 중대한 버그를 생산하는 일이 많아졌다.
- 현재의 애플리케이션을 기능별로 나눈다고 가정했을 때 수십개의 마이크로서비스가 가능하다.

<br>

## 모놀리틱 아키텍처와 마이크로서비스 아키텍처

> 마이크로서비스 아키텍처를 잘 이해하기 위해서는 반대되는 개념인 모놀리틱 아키텍처에 대해서 알아야 한다.

<img src="https://user-images.githubusercontent.com/124122215/226503742-0e84bac4-6f7b-47f4-8dee-1481d6f3e5ac.png" style="background-color:white;" width="50%">

### 모놀리틱 아키텍처

> 하나의 프로젝트로 구성되어 있으며 단일한 패키지로 배포된다.

- 장점

  - 단순한 구성의 애플리케이션은 로컬 환경에서 개발하기에도 편리하고 시나리오 테스트를 수행하기도 쉽다.
  - 모든 코드가 하나로 묶이기 때문에 배포가 매우 간단하다.

- 단점
  - 규모가 커지면 서비스 복잡도가 증가하면서 확장성이 떨어진다.
    - 복잡한 구조로 인해 중복된 코드를 생산, 데드코드가 쌓이게 된다.
  - 간단한 변화 하나에도 통합 테스트가 필요하다.
  - 배포 시간의 증가, 부분적 스케일 아웃의 어려움, 안정성의 감소
  - 프로그래밍 언어, 프레임워크의 변경이 불가능에 가까움

<br>

<img src="https://user-images.githubusercontent.com/124122215/226504635-1cdbc087-ae71-4636-84eb-22f1fd885df6.png" style="background-color:white;" width="80%">

### 마이크로서비스 아키텍처

> 모놀리틱 아키텍처로 구성된 하나의 큰 서비스를 독립적인 역할을 수행하는 작은 단위의 서비스로 분리하여 설계하는 패턴

- 각각의 마이크로서비스 마다 별도의 데이터베이스를 사용하는 것이 가능하다.
  - 어떤 서비스에서 사용하는 데이터는 변경이 적고 주로 읽기 작업만 수행되는 반면, 또 다른 서비스의 데이터는 읽기 작업보다 빠른 속도로 쓰여지는 작업이 대부분이라면 각각의 서비스 특성에 맞게 데이터베이스의 종류를 결정하고 설계할 수 있다.

<br>

- 장점

  - 서비스가 개별적으로 독립적인 단위의 애플리케이션이기 때문에 변경이 용이하고 그 변경이 다른 서비스에 미치는 영향이 적다.
  - 개별 서비스 단위의 배포가 가능
  - 부하가 집중되는 특정 서비스를 위해 전체 애플리케이션을 스케일 아웃할 필요가 없기 대문에 불필요한 자원낭비 감소
    - 효율적인 자원사용 가능

- 단점
  - 서비스 간의 통신에 대한 처리가 추가적으로 필요
    - 응답속도의 증가에 영향을 미침
  - 분산된 데이터베이스는 트랜잭션 관리가 용이하지 않기 때문에 데이터의 정합성을 맞추기 위한 노력이 필요
  - 서비스가 분산되어있어 관리 포인트가 증가하고, 모니터링하고 운영하는 것이 어려움
    - 필연적으로 매우 정교한 배포 자동화를 필요로 하며, 컨테이너 기술의 활용이 필요

<br>

### API Gateway

<img src="https://user-images.githubusercontent.com/124122215/226506090-9b14ef83-e5c5-4013-839f-70548b4ce6b5.png" style="background-color:white;" width="70%">

#### 문제점

- 각각의 마이크로서비스에 요청을 보내기 위해서는 클라이언트가 모든 마이크로서비스의 호스트명은 물론 end_point 를 알고 있어야 한다.
  - 요청을 보내야하는 서비스의 개수가 증가할 수록 응답속도가 늦어진다.
- 모든 마이크로서비스가 웹 통신에 적합한 프로토콜로 통신하지 않는다는 점

<br>

#### API Gateway를 이용한 해결책

<img src="https://user-images.githubusercontent.com/124122215/226507016-c7d0adc7-e71f-4223-8b75-ead207d0bf8e.png" style="background-color:white;" width="70%">

> API Gateway 는 서비스로 전달되는 모든 API 요청의 관문역할을 하는 서버이다.

- API Gateway 를 이용하여 시스템의 아키텍처 내부를 숨기고 외부의 요청에 대한 응답만을 적합한 형태로 응답한다.

  - 각각의 마이크로서비스로부터 받은 응답들을 API Gateway는 다시 취합하여 클라이언트에게 전달하는 역할 수행

- API Gateway 를 비동기적이고 non-blocking I/O 처리가 가능하도록 구현하는 것이 적은 비용으로 최대의 성능을 발휘할 수 있는 관건
